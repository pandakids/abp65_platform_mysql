(function(n){app.modals.ChangeProfilePictureModal=function(){var r,t=null,i=null,u=abp.services.app.profile;this.init=function(u){r=u;n("#ChangeProfilePictureModalForm input[name=ProfilePicture]").change(function(){n("#ChangeProfilePictureModalForm").submit()});n("#ChangeProfilePictureModalForm").ajaxForm({beforeSubmit:function(t){var e=n("#ChangeProfilePictureModalForm input[name=ProfilePicture]"),r=e.get()[0].files,i,u,f;return r.length?(i=r[0],u="|"+i.type.slice(i.type.lastIndexOf("/")+1)+"|","|jpg|jpeg|png|gif|".indexOf(u)===-1)?(abp.message.warn(app.localize("ProfilePicture_Warn_FileType")),!1):i.size>5242880?(abp.message.warn(app.localize("ProfilePicture_Warn_SizeLimit",app.maxProfilPictureBytesUserFriendlyValue)),!1):(f=_.filter(t,{name:"ProfilePicture"})[0].value.type,t.push({name:"FileType",value:f}),t.push({name:"FileName",value:"ProfilePicture"}),t.push({name:"FileToken",value:app.guid()}),!0):!1},success:function(r){if(r.success){var u=n("#ProfilePictureResize"),f=abp.appPath+"File/DownloadTempFile?fileToken="+r.result.fileToken+"&fileName="+r.result.fileName+"&fileType="+r.result.fileType+"&v="+(new Date).valueOf();i=r.result.fileToken;t&&t.destroy();u.show();u.attr("src",f);u.attr("originalWidth",r.result.width);u.attr("originalHeight",r.result.height);u.Jcrop({setSelect:[0,0,100,100],aspectRatio:1,boxWidth:400,boxHeight:400},function(){t=this})}else abp.message.error(r.error.message)}});n("#ProfilePictureResize").hide()};this.save=function(){var f,e,o;if(i){f={};t&&(f=t.getSelection());var s=t.getContainerSize()[0],h=t.getContainerSize()[1],c=s,l=h;n("#ProfilePictureResize")&&(c=parseInt(n("#ProfilePictureResize").attr("originalWidth")),l=parseInt(n("#ProfilePictureResize").attr("originalHeight")));e=c/s;o=l/h;u.updateProfilePicture({fileToken:i,x:parseInt(f.x*e),y:parseInt(f.y*o),width:parseInt(f.w*e),height:parseInt(f.h*o)}).done(function(){t.destroy();t=null;n(".header-profile-picture").attr("src",app.getUserProfilePicturePath());r.close()})}}}})(jQuery);