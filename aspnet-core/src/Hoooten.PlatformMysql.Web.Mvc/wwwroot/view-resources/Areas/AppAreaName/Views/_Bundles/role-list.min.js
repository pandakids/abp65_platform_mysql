var PermissionsTree=function(n){return function(){function r(){var i=!1;n("#PermissionTreeFilter").keyup(function(){i&&clearTimeout(i);i=setTimeout(function(){var i=n("#PermissionTreeFilter").val();t.jstree(!0)&&t.jstree(!0).search(i)},250)})}function u(u){t=u;t.jstree({types:{"default":{icon:"fa fa-folder m--font-warning"},file:{icon:"fa fa-file  m--font-warning"}},checkbox:{keep_selected_style:!1,three_state:!1,cascade:""},search:{show_only_matches:!0},plugins:["checkbox","types","search"]});t.on("changed.jstree",function(r,u){if(u.node){var f;u.node.state.selected?(i(t.jstree("get_parent",u.node)),f=n.makeArray(t.jstree("get_node",u.node).children),t.jstree("select_node",f)):(f=n.makeArray(t.jstree("get_node",u.node).children),t.jstree("deselect_node",f))}});r()}function i(n){t.jstree("select_node",n,!0);var r=t.jstree("get_parent",n);r&&i(r)}function f(){for(var i=[],r=t.jstree("get_selected",!0),n=0;n<r.length;n++)i.push(r[n].id);return i}var t;return{init:u,getSelectedPermissionNames:f}}}(jQuery);(function(){app.modals.CreateOrEditRoleModal=function(){var n,r=abp.services.app.role,t=null,i;this.init=function(r){n=r;i=new PermissionsTree;i.init(n.getModal().find(".permission-tree"));t=n.getModal().find("form[name=RoleInformationsForm]");t.validate({ignore:""})};this.save=function(){if(t.valid()){var u=t.serializeFormToObject();n.setBusy(!0);r.createOrUpdateRole({role:u,grantedPermissionNames:i.getSelectedPermissionNames()}).done(function(){abp.notify.info(app.localize("SavedSuccessfully"));n.close();abp.event.trigger("app.createOrEditRoleModalSaved")}).always(function(){n.setBusy(!1)})}}}})(),function(){$(function(){function o(){return abp.custom.EntityHistory&&abp.custom.EntityHistory.IsEnabled&&_.filter(abp.custom.EntityHistory.EnabledEntities,function(n){return n===i}).length===1}function h(i){abp.message.confirm(app.localize("RoleDeleteWarningMessage",i.displayName),app.localize("AreYouSure"),function(r){r&&t.deleteRole({id:i.id}).done(function(){n();abp.notify.success(app.localize("SuccessfullyDeleted"))})})}function n(){s.ajax.reload()}var f=$("#RolesTable"),t=abp.services.app.role,i="Hoooten.PlatformMysql.Authorization.Roles.Role",r={create:abp.auth.hasPermission("Pages.Administration.Roles.Create"),edit:abp.auth.hasPermission("Pages.Administration.Roles.Edit"),"delete":abp.auth.hasPermission("Pages.Administration.Roles.Delete")},u=new app.ModalManager({viewUrl:abp.appPath+"AppAreaName/Roles/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/AppAreaName/Views/Roles/_CreateOrEditModal.js",modalClass:"CreateOrEditRoleModal"}),e=app.modals.EntityTypeHistoryModal.create(),s=f.DataTable({paging:!1,serverSide:!1,processing:!1,drawCallback:function(){$("[data-toggle=m-tooltip]").tooltip()},listAction:{ajaxFunction:t.getRoles,inputFilter:function(){return{permission:$("#PermissionSelectionCombo").val()}}},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,autoWidth:!1,defaultContent:"",rowAction:{text:'<i class="fa fa-cog"><\/i> '+app.localize("Actions")+' <span class="caret"><\/span>',items:[{text:app.localize("Edit"),visible:function(){return r.edit},action:function(n){u.open({id:n.record.id})}},{text:app.localize("Delete"),visible:function(n){return!n.record.isStatic&&r.delete},action:function(n){h(n.record)}},{text:app.localize("History"),visible:function(){return o()},action:function(n){e.open({entityTypeFullName:i,entityId:n.record.id,entityTypeDescription:n.record.displayName})}}]}},{targets:2,data:"displayName",render:function(n,t,i){var r=$("<span/>");return r.append(n+" &nbsp;"),i.isStatic&&r.append($("<span/>").addClass("m-badge m-badge--brand m-badge--wide").attr("data-toggle","m-tooltip").attr("title",app.localize("StaticRole_Tooltip")).attr("data-placement","top").text(app.localize("Static")).css("margin-right","5px")),i.isDefault&&r.append($("<span/>").addClass("m-badge m-badge--metal m-badge--wide").attr("data-toggle","m-tooltip").attr("title",app.localize("DefaultRole_Description")).attr("data-placement","top").text(app.localize("Default")).css("margin-right","5px")),r[0].outerHTML}},{targets:3,data:"creationTime",render:function(n){return moment(n).format("L")}}]});$("#CreateNewRoleButton").click(function(){u.open()});$("#RefreshRolesButton").click(function(t){t.preventDefault();n()});abp.event.on("app.createOrEditRoleModalSaved",function(){n()})})}();