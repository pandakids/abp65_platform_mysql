(function(){$(function(){function s(n){abp.message.confirm(app.localize("NotificationDeleteWarningMessage"),app.localize("AreYouSure"),function(i){i&&r.deleteNotification({id:n.id}).done(function(){t();abp.notify.success(app.localize("SuccessfullyDeleted"))})})}function u(n){return n.state==="READ"?"notification-read":""}function t(){o.ajax.reload()}function h(t,i){n.setAsRead(t.id,function(){i&&i()})}function c(){n.setAllAsRead(function(){t()})}function l(){n.openSettingsModal()}var f=$("#NotificationsTable"),r=abp.services.app.notification,i=$("#TargetValueFilterSelectionCombobox");i.selectpicker();var n=new app.UserNotificationHelper,e=function(t,i){var u=$("<span/>"),r=$("<button/>").addClass("btn btn-sm btn-primary").attr("title",app.localize("SetAsRead")).click(function(n){n.preventDefault();h(i,function(){r.find("i").removeClass("la-circle-o").addClass("la-check");r.attr("disabled","disabled");t.closest("tr").addClass("notification-read")})}).appendTo(u),o=$("<button/>").addClass("btn btn-sm btn-danger").attr("title",app.localize("Delete")).click(function(){s(i)}).appendTo(u),f,e;$('<i class="la la-remove" >').appendTo(o);f=$('<i class="la" >').appendTo(r);e=n.format(i).state;e==="READ"&&(r.attr("disabled","disabled"),f.addClass("la-check"));e==="UNREAD"&&f.addClass("la-circle-o");t.append(u)},o=f.DataTable({paging:!0,serverSide:!0,processing:!0,listAction:{ajaxFunction:r.getUserNotifications,inputFilter:function(){return{state:i.val()}}},columnDefs:[{className:"control responsive",orderable:!1,render:function(){return""},targets:0},{targets:1,data:null,orderable:!1,defaultContent:"",createdCell:function(n,t,i){e($(n),i)}},{targets:2,data:"notification",render:function(t,i,r){var e,f=n.format(r,!1),o=u(f);return e=f.url&&f.url!=="#"?$('<a title="'+f.text+'" href="'+f.url+'" class="'+o+'">'+abp.utils.truncateStringWithPostfix(f.text,120)+"<\/a>"):$('<span title="'+f.text+'" class="'+o+'">'+abp.utils.truncateStringWithPostfix(f.text,120)+"<\/span>"),e[0].outerHTML}},{targets:3,data:"creationTime",render:function(t,i,r){var f=n.format(r),e=u(f),o=$('<span title="'+moment(t).format("llll")+'" class="'+e+'">'+f.timeAgo+"<\/span> &nbsp;");return o[0].outerHTML}}]});i.change(function(){t()});$("#RefreshNotificationTableButton").click(function(n){n.preventDefault();t()});$("#btnOpenNotificationSettingsModal").click(function(){l()});$("#btnSetAllNotificationsAsRead").click(function(n){n.preventDefault();c()})})})();